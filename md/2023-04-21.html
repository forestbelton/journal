<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2023-04-21" />
  <title>Journal Notes</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../static/journal.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Journal Notes</h1>
<p class="date">2023-04-21</p>
</header>
<p>I find myself on the Steam Store a lot. It’s fun to click around and look at games, but I rarely make a purchase. Recently, a game in the “popular upcoming” section called <a href="https://store.steampowered.com/app/2280000/SQUARE_ENIX_AI_Tech_Preview_THE_PORTOPIA_SERIAL_MURDER_CASE/">SQUARE ENIX AI Tech Preview: THE PORTOPIA SERIAL MURDER CASE</a> caught my attention. The Steam page has this to say about the game:</p>
<blockquote>
<p>This software is an educational demonstration of Natural Language Processing (NLP), an AI technology, as applied to the adventure game “The Portopia Serial Murder Case” (created by Yuji Horii and first published in Japan in 1983). At the time of the game’s original release, most adventure games were played using a “command input” system, where the player was asked to type in text to decide the actions of their character. Free text input systems like these allowed players to feel a great deal of freedom. However, they did come with one common source of frustration: players knowing what action they wanted to perform but being unable to do so because they could not find the right wording. This problem was caused by the limitations of PC performance and NLP technology of the time. 40 years have passed since then, and PC performance has drastically improved, as have the capabilities of NLP technology. Using “The Portopia Serial Murder Case” as a test case, we’d like to show you the capabilities of modern NLP and the impact it can have on adventure games, as well as deepen your understanding of NLP technologies.</p>
</blockquote>
<p>It’s exciting to see a company like Square Enix experimenting with NLP technology. I wonder what techniques they are using to accomplish this. Unfortunately, it seems like they haven’t shared any details about it yet. The blog for SQUARE ENIX AI Division has this to say on its <a href="https://www.jp.square-enix.com/ai-division/en/2023/04/square-enix-ai-tech-preview-the-portopia-serial-murder-case-will-be-available.html">latest post</a>:</p>
<blockquote>
<p>So what is NLP? Don’t worry, our experts will explain it soon on this AI technology blog. In the meantime, please wait a while and try the trending technology called NLP for yourself!</p>
</blockquote>
<h2 id="colossal-cave-adventure">Colossal Cave Adventure</h2>
<p>I took the call to action and decided to try out this trending technology. The game isn’t out yet, but I could enhance an adventure game on my own. What better place to start than <a href="https://en.wikipedia.org/wiki/Colossal_Cave_Adventure">Colossal Cave Adventure</a> by <a href="https://en.wikipedia.org/wiki/William_Crowther_(programmer)">Will Crowther</a>? Widely considered the first text adventure game in the “interactive fiction” genre, Colossal Cave Adventure (or “Adventure”) centers around entering a cave system with unknown treasures inside. For a wealth of information about the game and its creation, check out the lovely site by <a href="https://rickadams.org/adventure/">Rick Adams</a>.</p>
<h3 id="goals">Goals</h3>
<p>The two goals for this project were:</p>
<ol type="1">
<li>Have fun</li>
<li>Improve understanding of software (PyTorch, RWKV-LM, OpenAI API, et al.)</li>
</ol>
<p>This means there were some instances where a simpler approach would have been just as effective. It’s more fun to use new, shiny things. It also provided an opportunity for evaluation, given the underlying problem is easily understood.</p>
<h3 id="game-command-execution">Game command execution</h3>
<p>I chose <a href="https://gitlab.com/esr/open-adventure">open-adventure</a> for an implementation of Colossal Cave Adventure. It was a pleasant surprise to see ESR actively developing it. The dictionary of valid game words is in <a href="https://gitlab.com/esr/open-adventure/-/blob/f0119f8431be30713e29ef89a63a45d0fa28111c/adventure.yaml">/adventure.yaml</a>. The relevant type is called <code>command_t</code> and defined in <a href="https://gitlab.com/esr/open-adventure/-/blob/f0119f8431be30713e29ef89a63a45d0fa28111c/advent.h#L282">/advent.h</a> (comments my own):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">typedef</span> <span class="kw">struct</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="kw">enum</span> speechpart part; <span class="co">// Transitive, intransitive, unknown</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>    command_word_t word[<span class="dv">2</span>]; <span class="co">// Raw word and its type</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    verb_t verb;</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    obj_t obj;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    command_state_t state;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>} command_t;</span></code></pre></div>
<p>The four word types correspond to locations the player can move to, specific in-game objects, player actions, and nonnegative integers. Each word may have several aliases. Players can input 1-2 words per line. If a complete <code>command_t</code> can’t be constructed the game will ask followup questions. Once enough context is available <a href="https://gitlab.com/esr/open-adventure/-/blob/f0119f8431be30713e29ef89a63a45d0fa28111c/main.c#L1165">the action is performed</a>.</p>
<h2 id="implementation">Implementation</h2>
<p>The command structure was the only component of <code>open-adventure</code> needed for implementing an enhanced input prompt. I built the project by:</p>
<ol type="1">
<li>Using OpenAI’s chat completion to complete word fragments in the game dictionary. Every word in the dictionary longer than 5 characters was truncated — likely a reflection of original hardware requirements.</li>
<li>Generating a corpus of example English sentences mapped to game commands.</li>
<li>Finetuning an <a href="https://github.com/BlinkDL/RWKV-LM">RWKV-LM</a> model from the generated corpus. <a href="https://huggingface.co/BlinkDL/rwkv-4-pile-169m">RWKV-Pile-169M</a> was used due to its low hardware requirements.</li>
<li>Writing a wrapper program to connect the language model to the game.</li>
</ol>
<p>Over the next couple of days I will describe how each component was built. The last post will include a link to the repository with instructions on how to build the augmented game. Better brush up on those caving skills!</p>
</body>
</html>
